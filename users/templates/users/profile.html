{% extends "users/base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2>پروفایل کاربری</h2>
      </div>
      
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-success" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
      
      <div class="row">
        <!-- اطلاعات پایه کاربر -->
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">اطلاعات کاربری</h5>
            </div>
            <div class="card-body text-center">
              {% if request.user.profile_image %}
                <img src="{{ request.user.profile_image.url }}" alt="Profile Image" class="img-fluid rounded-circle mb-3" style="height: 150px; width: 150px; object-fit: cover;">
              {% else %}
                <div class="bg-light rounded-circle d-inline-flex justify-content-center align-items-center mb-3" style="height: 150px; width: 150px;">
                  <i class="bi bi-person-circle" style="font-size: 5rem;"></i>
                </div>
              {% endif %}
              
              <h4>{{ request.user.user_name }}</h4>
              <p class="text-muted mb-1">{{ request.user.email }}</p>
              
              <div class="mt-3">
                <h6>نقش‌های کاربری:</h6>
                {% for role in roles %}
                  <span class="badge bg-info">{{ role.fa_name }}</span>
                {% empty %}
                  <span class="badge bg-secondary">بدون نقش</span>
                {% endfor %}
              </div>
              
              <div class="mt-4">
                <a href="{% url 'users:change_password' %}" class="btn btn-warning">
                    <i class="bi bi-key me-1"></i> تغییر رمز عبور
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- فرم ویرایش پروفایل -->
        <div class="col-md-8">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">ویرایش اطلاعات شخصی</h5>
            </div>
            <div class="card-body">
              <form method="post" action="" enctype="multipart/form-data">
                {% csrf_token %}
                
                {% if form.errors %}
                  <div class="alert alert-danger">
                    <h4 class="alert-heading">خطاهای فرم را اصلاح کنید:</h4>
                    <ul>
                      {% for field in form %}
                        {% for error in field.errors %}
                          <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                      {% endfor %}
                    </ul>
                  </div>
                {% endif %}
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="{{ form.first_name.id_for_label }}" class="form-label">نام:</label>
                      {{ form.first_name }}
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="{{ form.last_name.id_for_label }}" class="form-label">نام خانوادگی:</label>
                      {{ form.last_name }}
                    </div>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="{{ form.profile_image.id_for_label }}" class="form-label">تصویر پروفایل:</label>
                  {{ form.profile_image }}
                  <div class="form-text">فرمت‌های مجاز: JPG، PNG، GIF (حداکثر 2 مگابایت)</div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-save me-1"></i> ذخیره تغییرات
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}